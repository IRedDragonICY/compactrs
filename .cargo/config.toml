# ═══════════════════════════════════════════════════════════════════════════════
# Cargo Configuration for CompactRS
# ═══════════════════════════════════════════════════════════════════════════════
#
# DEVELOPMENT (normal cargo run - uses stable toolchain):
#   cargo run
#
# OPTIMIZED RELEASE (requires nightly):
#   cargo +nightly build --release ^
#     -Z build-std=std,panic_abort,core,alloc ^
#     -Z build-std-features=optimize_for_size ^
#     --target x86_64-pc-windows-msvc
#
# ═══════════════════════════════════════════════════════════════════════════════

# Only apply linker optimizations for explicit target builds (release)
# This does NOT affect normal "cargo run" which uses host target
[target.x86_64-pc-windows-msvc]
rustflags = [
    "-C", "target-cpu=native",
    "-C", "link-arg=/MERGE:.rdata=.text",
    "-C", "link-arg=/MERGE:.pdata=.text",
    "-C", "link-arg=/OPT:REF,ICF",
    "-C", "link-arg=/INCREMENTAL:NO",
]

# NOTE: The following flags are passed via command line for nightly builds:
#   -Z mir-opt-level=4
#   -Z location-detail=none
#   -Z fmt-debug=none
#   -Z build-std=std,panic_abort,core,alloc
#   -Z build-std-features=optimize_for_size
